<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ - –ê—Ñ–∏—à–∞</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fff;
      color: #1a1a1a;
      line-height: 1.5;
    }
    
    .header {
      background: #fff;
      border-bottom: 1px solid #e5e5e5;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px;
      height: 64px;
      display: flex;
      align-items: center;
      gap: 32px;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      text-decoration: none;
    }
    
    .logo-icon {
      width: 36px;
      height: 36px;
      background: #e53935;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 20px;
    }
    
    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }
    
    .logo-name {
      font-weight: 600;
      font-size: 16px;
      color: #1a1a1a;
    }
    
    .logo-city {
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .header-actions {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .search-btn {
      font-size: 20px;
      cursor: pointer;
      color: #666;
    }
    
    .login-btn {
      padding: 8px 16px;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      color: #1a1a1a;
    }
    
    .category-nav {
      background: #fff;
      border-bottom: 1px solid #e5e5e5;
      overflow-x: auto;
    }
    
    .category-nav::-webkit-scrollbar {
      display: none;
    }
    
    .category-nav-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      gap: 8px;
      height: 48px;
      align-items: center;
    }
    
    .category-tab {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: #1a1a1a;
      background: #f5f5f5;
      cursor: pointer;
      white-space: nowrap;
      text-decoration: none;
      transition: background 0.2s;
    }
    
    .category-tab:hover {
      background: #e8e8e8;
    }
    
    .category-tab.active {
      background: #1a1a1a;
      color: #fff;
    }
    
    .category-more {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      color: #666;
    }
    
    .main-content {
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px;
    }
    
    .hero-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 40px;
      border-radius: 16px;
      overflow: hidden;
      height: 400px;
    }
    
    .hero-main {
      position: relative;
      background: #333;
      overflow: hidden;
    }
    
    .hero-main img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.2) 50%, transparent 100%);
    }
    
    .hero-rating {
      position: absolute;
      top: 16px;
      left: 16px;
      width: 40px;
      height: 40px;
      background: #4caf50;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }
    
    .hero-content {
      position: absolute;
      bottom: 24px;
      left: 24px;
      right: 24px;
      color: white;
    }
    
    .hero-category {
      font-size: 12px;
      text-transform: uppercase;
      opacity: 0.8;
      margin-bottom: 8px;
    }
    
    .hero-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 16px;
      line-height: 1.2;
    }
    
    .hero-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: #fff;
      color: #1a1a1a;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .hero-btn:hover {
      background: #f5f5f5;
    }
    
    .hero-gallery {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 8px;
    }
    
    .hero-gallery-item {
      background: #eee;
      overflow: hidden;
    }
    
    .hero-gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .section {
      margin-bottom: 40px;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 24px;
      font-weight: 600;
    }
    
    .section-link {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      border: 1px solid #e5e5e5;
      border-radius: 20px;
      font-size: 13px;
      color: #1a1a1a;
      text-decoration: none;
      cursor: pointer;
    }
    
    .section-link:hover {
      background: #f5f5f5;
    }
    
    .sessions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }
    
    .session-card {
      padding: 16px;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      cursor: pointer;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .session-card:hover {
      border-color: #4caf50;
      box-shadow: 0 2px 8px rgba(76,175,80,0.15);
    }
    
    .session-price {
      font-size: 12px;
      color: #4caf50;
      margin-bottom: 8px;
    }
    
    .session-time {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .session-address {
      font-size: 13px;
      color: #666;
    }
    
    .full-schedule {
      margin-top: 32px;
    }
    
    .schedule-row {
      display: flex;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .schedule-date {
      width: 100px;
      flex-shrink: 0;
    }
    
    .schedule-day-num {
      font-size: 36px;
      font-weight: 300;
      line-height: 1;
    }
    
    .schedule-day-num sup {
      font-size: 14px;
      vertical-align: super;
    }
    
    .schedule-day-name {
      font-size: 11px;
      color: #e53935;
      text-transform: uppercase;
      margin-top: 4px;
    }
    
    .schedule-info {
      flex: 1;
      padding: 16px 24px;
      background: #f9f9f9;
      border-radius: 8px;
      margin: 0 24px;
    }
    
    .schedule-time {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .schedule-venue {
      font-size: 13px;
      color: #666;
    }
    
    .schedule-price-btn {
      padding: 12px 24px;
      background: #1a1a1a;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .schedule-price-btn:hover {
      background: #333;
    }
    
    .about-section {
      margin-bottom: 40px;
    }
    
    .about-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    
    .about-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .about-text {
      font-size: 15px;
      color: #333;
      line-height: 1.7;
      max-width: 800px;
    }
    
    .age-section {
      margin-bottom: 40px;
    }
    
    .age-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }
    
    .age-value {
      font-size: 18px;
      font-weight: 600;
    }
    
    .recommendations-section {
      margin-bottom: 40px;
    }
    
    .recs-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    .recs-scroll {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding-bottom: 16px;
    }
    
    .recs-scroll::-webkit-scrollbar {
      height: 6px;
    }
    
    .recs-scroll::-webkit-scrollbar-track {
      background: #f5f5f5;
      border-radius: 3px;
    }
    
    .recs-scroll::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 3px;
    }
    
    .rec-card {
      flex: 0 0 180px;
      cursor: pointer;
    }
    
    .rec-card-image {
      position: relative;
      width: 180px;
      height: 240px;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 12px;
    }
    
    .rec-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .rec-card-rating {
      position: absolute;
      top: 12px;
      left: 12px;
      padding: 4px 10px;
      background: #4caf50;
      border-radius: 12px;
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .rec-card-title {
      font-size: 14px;
      font-weight: 500;
      color: #1a1a1a;
    }
    
    .footer {
      background: #f5f5f5;
      padding: 40px 0;
      margin-top: 40px;
    }
    
    .footer-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px;
    }
    
    .footer-links {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .footer-column a {
      display: block;
      color: #666;
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 12px;
    }
    
    .footer-column a:hover {
      color: #1a1a1a;
    }
    
    .footer-copy {
      font-size: 12px;
      color: #999;
      padding-top: 24px;
      border-top: 1px solid #e5e5e5;
    }
    
    .order-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .order-modal.active {
      display: flex;
    }
    
    .order-modal-content {
      background: #fff;
      border-radius: 16px;
      padding: 32px;
      max-width: 480px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .order-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
    }
    
    .order-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .form-label {
      font-size: 13px;
      font-weight: 500;
      color: #666;
    }
    
    .form-input {
      padding: 12px 16px;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #4caf50;
    }
    
    .order-submit {
      padding: 14px 24px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 8px;
    }
    
    .order-submit:hover {
      background: #43a047;
    }
    
    .order-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .selected-session {
      padding: 16px;
      background: #f5f5f5;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    
    .selected-session-time {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .selected-session-price {
      color: #4caf50;
      font-size: 14px;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
      font-size: 16px;
      color: #666;
    }
    
    @media (max-width: 768px) {
      .hero-section {
        grid-template-columns: 1fr;
        height: auto;
      }
      
      .hero-main {
        height: 300px;
      }
      
      .hero-gallery {
        display: none;
      }
      
      .hero-title {
        font-size: 24px;
      }
      
      .sessions-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .category-nav-inner {
        padding: 0 16px;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo-section">
        <div class="logo-icon">a</div>
        <div class="logo-text">
          <span class="logo-name">–∞—Ñ–∏—à–∞</span>
          <span class="logo-city" id="cityName">–ú–û–°–ö–í–ê</span>
        </div>
      </a>
      
      <div class="header-actions">
        <div class="search-btn">üîç</div>
        <div class="login-btn">–í–û–ô–¢–ò</div>
      </div>
    </div>
  </header>

  <nav class="category-nav">
    <div class="category-nav-inner" id="categoryNav">
    </div>
  </nav>

  <main class="main-content" id="mainContent">
    <div class="loading" id="loadingState">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-links">
        <div class="footer-column">
          <a href="#">–í—ã—Å—Ç–∞–≤–∫–∏</a>
          <a href="#">–ú—É–∑–µ–∏</a>
          <a href="#">–ö–≤–µ—Å—Ç –∫–æ–º–Ω–∞—Ç–∞</a>
          <a href="#">–≠–∫—Å—Ç—Ä–∏–º</a>
          <a href="#">Daily</a>
        </div>
        <div class="footer-column">
          <a href="#">–ö–æ–º–Ω–∞—Ç–∞ –≥–Ω–µ–≤–∞</a>
          <a href="#">–ë–∏–ª—å—è—Ä–¥</a>
          <a href="#">–ë–æ—É–ª–∏–Ω–≥</a>
          <a href="/">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
          <a href="/admin">–ê–¥–º–∏–Ω</a>
        </div>
      </div>
      <div class="footer-copy">¬© 1999-2025 –û–û–û ¬´–ö–æ–º–ø–∞–Ω–∏—è –ê—Ñ–∏—à–∞¬ª. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –î–ª—è –ª–∏—Ü —Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç.</div>
    </div>
  </footer>

  <div class="order-modal" id="orderModal" onclick="closeOrderModal(event)">
    <div class="order-modal-content" onclick="event.stopPropagation()">
      <h2 class="order-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
      <div class="selected-session" id="selectedSession">
        <div class="selected-session-time" id="selectedTime">–ü—è—Ç–Ω–∏—Ü–∞ 17:00</div>
        <div class="selected-session-price" id="selectedPrice">–æ—Ç 2490 ‚ÇΩ</div>
      </div>
      <form class="order-form" id="orderForm" onsubmit="submitOrder(event)">
        <div class="form-group">
          <label class="form-label">–ò–º—è</label>
          <input type="text" class="form-input" id="customerName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="customerEmail" required placeholder="email@example.com">
        </div>
        <div class="form-group">
          <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input type="tel" class="form-input" id="customerPhone" required placeholder="+7 (999) 123-45-67">
        </div>
        <div class="form-group">
          <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
          <input type="number" class="form-input" id="ticketCount" min="1" max="10" value="1" required>
        </div>
        <button type="submit" class="order-submit" id="submitBtn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </form>
    </div>
  </div>

  <script>
    let event = null;
    let events = [];
    let categories = [];
    let selectedSessionData = null;
    
    const defaultImages = [
      'https://images.unsplash.com/photo-1540039155733-5bb30b53aa14?w=800&q=80',
      'https://images.unsplash.com/photo-1507676184212-d03ab07a01bf?w=800&q=80',
      'https://images.unsplash.com/photo-1544928147-79a2dbc1f389?w=800&q=80',
      'https://images.unsplash.com/photo-1518834107812-67b0b7c58434?w=800&q=80',
      'https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?w=800&q=80',
      'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800&q=80'
    ];
    
    const categoryTabs = [
      '–í–´–°–¢–ê–í–ö–ò', '–ú–£–ó–ï–ò', '–ö–í–ï–°–¢ –ö–û–ú–ù–ê–¢–ê', '–≠–ö–°–¢–†–ò–ú', 
      'DAILY', '–ö–û–ú–ù–ê–¢–ê –ì–ù–ï–í–ê', '–ë–ò–õ–¨–Ø–†–î', '–ë–û–£–õ–ò–ù–ì'
    ];
    
    let isGeneratedLink = false;
    let linkCode = null;
    
    function getEventId() {
      const path = window.location.pathname;
      const match = path.match(/\/event\/(\d+)/);
      return match ? parseInt(match[1]) : 1;
    }
    
    function getLinkCode() {
      const path = window.location.pathname;
      const match = path.match(/\/e\/([A-Z0-9-]+)/i);
      return match ? match[1] : null;
    }
    
    async function loadData() {
      linkCode = getLinkCode();
      isGeneratedLink = !!linkCode;
      
      try {
        if (isGeneratedLink) {
          // Load from generated link
          const linkRes = await fetch(`/api/event-link/${linkCode}`);
          if (linkRes.ok) {
            const linkData = await linkRes.json();
            if (linkData && !linkData.error) {
              event = {
                id: linkData.id,
                name: linkData.name,
                description: linkData.description,
                price: 2490,
                categoryName: linkData.categoryName,
                cityName: linkData.cityName,
                venue: linkData.venueAddress || '–ê–¥—Ä–µ—Å —É—Ç–æ—á–Ω—è–µ—Ç—Å—è',
                date: linkData.eventDate,
                time: linkData.eventTime,
                availableSeats: linkData.availableSeats,
                coverImageUrl: linkData.imageUrl,
                linkCode: linkData.linkCode,
                cityId: linkData.cityId
              };
            }
          }
          if (!event) {
            event = getDemoEvent();
          }
        } else {
          // Regular event loading from template
          const eventId = getEventId();
          const templateRes = await fetch(`/api/generator/event-templates/${eventId}`);
          
          if (templateRes.ok) {
            const templateData = await templateRes.json();
            if (templateData && !templateData.error) {
              event = {
                id: templateData.id,
                name: templateData.name,
                description: templateData.description,
                price: 2490,
                categoryName: templateData.categoryName,
                cityName: '–ú–æ—Å–∫–≤–∞',
                venue: '–ê–¥—Ä–µ—Å —É—Ç–æ—á–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è',
                date: new Date().toISOString(),
                availableSeats: 50,
                coverImageUrl: templateData.imageUrl
              };
            }
          }
          
          if (!event) {
            event = getDemoEvent();
          }
        }
      } catch (err) {
        console.error('Error loading data:', err);
        event = getDemoEvent();
        events = [event, ...getDemoRecommendations()];
      }
      
      renderPage();
    }
    
    function getDemoEvent() {
      return {
        id: 1,
        name: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¢–∏—Ä',
        description: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–∏—Ä, –≥–¥–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ –∞—Ä–æ–º–∞—Ç–æ–º –ø–æ—Ä–æ—Ö–∞, –∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ –æ—Ç –º–µ—Ç–∫–æ—Å—Ç–∏ ‚Äî –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è. –û—â—É—Ç–∏—Ç–µ –º–æ—â—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å, –¥–µ—Ä–∂–∞ –≤ —Ä—É–∫–∞—Ö —Ä–µ–∞–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ, –∏—Å—Å–ª–µ–¥—É—è —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ —Å—Ç—Ä–µ–ª—å–±—ã. –≠—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø—ã—Ç–∞—Ç—å –≤–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞, —Å–æ–±–ª—é–¥–∞—è –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –¢–∏—Ä ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞–≤—ã–∫–æ–≤ —Å—Ç—Ä–µ–ª—å–±—ã, –Ω–æ –∏ –≤—Å—Ç—Ä–µ—á–∞ —Å —ç–Ω–µ—Ä–≥–∏–µ–π, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–∏–Ω–æ—Å–∏—Ç –≤ —Å–µ–±–µ –∫–∞–∂–¥—ã–π –≤—ã—Å—Ç—Ä–µ–ª. –ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–º—É –æ–ø—ã—Ç—É, –≥–¥–µ –º–µ—Ç–∫–æ—Å—Ç—å –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –Ω–µ–ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–º—É —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏—é.',
        price: 2490,
        categoryName: '–≠–ö–°–¢–†–ò–ú',
        cityName: '–ú–æ—Å–∫–≤–∞',
        venue: '—É–ª. –ú–∞—Ä–∫–æ–≤–∞, 12',
        date: new Date().toISOString(),
        availableSeats: 50
      };
    }
    
    function getDemoRecommendations() {
      return [
        { id: 2, name: '–ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –∫–≤–∞–¥—Ä–æ—Ü–∏–∫–ª–∞—Ö', categoryName: '–≠–ö–°–¢–†–ò–ú', price: 2490 },
        { id: 3, name: '–ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –ª–æ—à–∞–¥—è—Ö', categoryName: '–≠–ö–°–¢–†–ò–ú', price: 2490 },
        { id: 4, name: '–ü–µ–π–Ω—Ç–±–æ–ª', categoryName: '–≠–ö–°–¢–†–ò–ú', price: 2490 },
        { id: 5, name: '–ê—ç—Ä–æ—Ç—Ä—É–±–∞', categoryName: '–≠–ö–°–¢–†–ò–ú', price: 2490 },
        { id: 6, name: '–°—Ç—Ä–µ–ª–∫–æ–≤—ã–π –∫–ª—É–± ¬´–ì—Ä–æ–º–æ–≤–µ—Ä–∂–µ—Ü¬ª', categoryName: '–≠–ö–°–¢–†–ò–ú', price: 2490 }
      ];
    }
    
    function renderPage() {
      renderCategoryNav();
      renderMainContent();
      document.title = `${event.name} - –ê—Ñ–∏—à–∞`;
    }
    
    function renderCategoryNav() {
      const nav = document.getElementById('categoryNav');
      nav.innerHTML = categoryTabs.map((tab, i) => `
        <a href="#" class="category-tab ${event.categoryName?.toUpperCase() === tab ? 'active' : ''}">${tab}</a>
      `).join('') + '<div class="category-more">‚Ä¢‚Ä¢‚Ä¢</div>';
    }
    
    function renderMainContent() {
      const main = document.getElementById('mainContent');
      const rating = (7.5 + Math.random() * 2).toFixed(1);
      const price = 2490;
      const venue = event.venue || '—É–ª. –ú–∞—Ä–∫–æ–≤–∞, 12';
      const city = event.cityName || '–ú–æ—Å–∫–≤–∞';
      const heroImage = event.coverImageUrl || defaultImages[0];
      
      const sessions = [
        { day: '–ü—è—Ç–Ω–∏—Ü–∞', time: '17:00' },
        { day: '–°—É–±–±–æ—Ç–∞', time: '11:00' },
        { day: '–°—É–±–±–æ—Ç–∞', time: '14:00' },
        { day: '–°—É–±–±–æ—Ç–∞', time: '17:00' }
      ];
      
      const recs = events.filter(e => e.id !== event.id).slice(0, 6);
      const recommendations = recs.length > 0 ? recs : getDemoRecommendations();
      
      main.innerHTML = `
        <section class="hero-section">
          <div class="hero-main">
            <img src="${heroImage}" alt="${event.name}">
            <div class="hero-overlay"></div>
            <div class="hero-rating">${rating}</div>
            <div class="hero-content">
              <div class="hero-category">${(event.categoryName?.toUpperCase() || '–°–û–ë–´–¢–ò–ï')} –í –ì–û–†–û–î–ï ${city.toUpperCase()}</div>
              <h1 class="hero-title">${event.name}</h1>
              <button class="hero-btn" onclick="scrollToSessions()">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –∫–∞—Ä—Ç—ã</button>
            </div>
          </div>
          <div class="hero-gallery">
            ${[1, 2, 3, 4].map(i => `
              <div class="hero-gallery-item">
                <img src="${defaultImages[i % defaultImages.length]}" alt="">
              </div>
            `).join('')}
          </div>
        </section>

        <section class="section" id="sessionsSection">
          <div class="section-header">
            <h2 class="section-title">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ–∞–Ω—Å–æ–≤</h2>
            <a href="#" class="section-link" onclick="toggleFullSchedule(event)">–ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Üí</a>
          </div>
          <div class="sessions-grid" id="sessionsGrid">
            ${sessions.map((s, i) => `
              <div class="session-card" onclick="goToBooking('${getSessionDate(s.day)}', '${s.time}')">
                <div class="session-price">–û—Ç ${formatPrice(price)} ‚ÇΩ</div>
                <div class="session-time">${s.day} ${s.time}</div>
                <div class="session-address">${city}, ${venue}</div>
              </div>
            `).join('')}
          </div>
          <div class="full-schedule" id="fullSchedule" style="display: none;">
            ${generateFullSchedule(price, city, venue)}
          </div>
        </section>

        <section class="about-section">
          <div class="about-label">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</div>
          <h2 class="about-title">–û ${event.name}</h2>
          <p class="about-text">${event.description || '–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å. –≠—Ç–æ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–∞—Ä–∏—Ç –≤–∞–º –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –∏ —ç–º–æ—Ü–∏–∏.'}</p>
        </section>

        <section class="age-section">
          <div class="age-label">–í–æ–∑—Ä–∞—Å—Ç</div>
          <div class="age-value">18+</div>
        </section>

        <section class="recommendations-section">
          <h2 class="recs-title">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—Å</h2>
          <div class="recs-scroll">
            ${recommendations.map((r, i) => {
              const recRating = (8 + Math.random() * 1.5).toFixed(1);
              const image = defaultImages[(i + 2) % defaultImages.length];
              return `
                <div class="rec-card" onclick="openEvent(${r.id})">
                  <div class="rec-card-image">
                    <img src="${image}" alt="${r.name}">
                    <div class="rec-card-rating">${recRating}</div>
                  </div>
                  <div class="rec-card-title">${r.name}</div>
                </div>
              `;
            }).join('')}
          </div>
        </section>
      `;
      
      document.getElementById('cityName').textContent = city.toUpperCase();
    }
    
    function formatPrice(price) {
      return price?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ') || '0';
    }
    
    function scrollToSessions() {
      document.getElementById('sessionsSection').scrollIntoView({ behavior: 'smooth' });
    }
    
    function selectSession(time, price) {
      selectedSessionData = { time, price };
      document.getElementById('selectedTime').textContent = time;
      document.getElementById('selectedPrice').textContent = `–æ—Ç ${formatPrice(price)} ‚ÇΩ`;
      document.getElementById('orderModal').classList.add('active');
    }
    
    function closeOrderModal(e) {
      if (e.target === document.getElementById('orderModal')) {
        document.getElementById('orderModal').classList.remove('active');
      }
    }
    
    async function submitOrder(e) {
      e.preventDefault();
      
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.textContent = '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ...';
      
      const orderData = {
        eventId: event.id,
        eventName: event.name,
        customerName: document.getElementById('customerName').value,
        customerEmail: document.getElementById('customerEmail').value,
        customerPhone: document.getElementById('customerPhone').value,
        seatsCount: parseInt(document.getElementById('ticketCount').value),
        sessionTime: selectedSessionData?.time,
        price: selectedSessionData?.price
      };
      
      try {
        const res = await fetch('/api/create-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });
        
        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          throw new Error(errorData.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        }
        
        const result = await res.json();
        
        if (result.success && result.orderCode) {
          window.location.href = '/payment?order=' + result.orderCode;
        } else if (result.success) {
          alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
          document.getElementById('orderModal').classList.remove('active');
          document.getElementById('orderForm').reset();
        } else {
          throw new Error(result.message || '–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞');
        }
      } catch (err) {
        alert(err.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
      }
      
      btn.disabled = false;
      btn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
    }
    
    function openEvent(id) {
      window.location.href = `/event/${id}`;
    }
    
    function getSessionDate(dayName) {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const targetDays = { '–ü—è—Ç–Ω–∏—Ü–∞': 5, '–°—É–±–±–æ—Ç–∞': 6, '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ': 0 };
      const target = targetDays[dayName];
      if (target === undefined) return today.toISOString().split('T')[0];
      
      let offset = target - dayOfWeek;
      if (offset <= 0) offset += 7;
      
      const date = new Date(today);
      date.setDate(today.getDate() + offset);
      return date.toISOString().split('T')[0];
    }
    
    function generateFullSchedule(price, city, venue) {
      const today = new Date();
      const scheduleData = [];
      const dayNames = ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï', '–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö', '–í–¢–û–†–ù–ò–ö', '–°–†–ï–î–ê', '–ß–ï–¢–í–ï–†–ì', '–ü–Ø–¢–ù–ò–¶–ê', '–°–£–ë–ë–û–¢–ê'];
      const monthAbbr = ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'];
      
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dayNum = date.getDate();
        const dayName = dayNames[date.getDay()];
        const isoDate = date.toISOString().split('T')[0];
        const times = date.getDay() === 0 || date.getDay() === 6 
          ? ['11:00', '14:00', '17:00'] 
          : ['17:00'];
        
        times.forEach(time => {
          scheduleData.push({ dayNum, dayName, time, month: monthAbbr[date.getMonth()], isoDate });
        });
      }
      
      return scheduleData.map(s => `
        <div class="schedule-row">
          <div class="schedule-date">
            <div class="schedule-day-num">${s.dayNum}<sup>${s.month}</sup></div>
            <div class="schedule-day-name">${s.dayName}</div>
          </div>
          <div class="schedule-info">
            <div class="schedule-time">${s.time}</div>
            <div class="schedule-venue">${city}, ${venue}</div>
          </div>
          <button class="schedule-price-btn" onclick="goToBooking('${s.isoDate}', '${s.time}')">–û—Ç ${formatPrice(price)} ‚ÇΩ</button>
        </div>
      `).join('');
    }
    
    function toggleFullSchedule(e) {
      e.preventDefault();
      const fullSchedule = document.getElementById('fullSchedule');
      const sessionsGrid = document.getElementById('sessionsGrid');
      const link = e.target;
      
      if (fullSchedule.style.display === 'none') {
        fullSchedule.style.display = 'block';
        sessionsGrid.style.display = 'none';
        link.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å ‚Üê';
      } else {
        fullSchedule.style.display = 'none';
        sessionsGrid.style.display = 'grid';
        link.textContent = '–ü–æ–ª–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Üí';
      }
    }
    
    function goToBooking(day, time) {
      if (isGeneratedLink && linkCode) {
        window.location.href = `/booking-link/${linkCode}?date=${day}&time=${encodeURIComponent(time)}`;
      } else {
        window.location.href = `/booking/${event.id}?date=${day}&time=${encodeURIComponent(time)}`;
      }
    }
    
    loadData();
  </script>
</body>
</html>
